<!DOCTYPE html>
<html lang="zh">
    <head>
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.4 -->

    <!-- Title -->
    
    <title>
        
            Event Bus一个安卓的优化方式 | 
        
        云枫飒的笔记BLOG
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
        <link rel="dns-prefetch" href="https://www.google-analytics.com"/>
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="yunfengsa">
    <meta name="description" content="Nothing can stop me moving on!">
    <meta name="keywords" content="null,android,EventBus">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="云枫飒的笔记BLOG">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yunfengsa.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Event Bus一个安卓的优化方式 | 云枫飒的笔记BLOG">
    <meta property="og:description" content="Nothing can stop me moving on!">
    <meta property="og:article:tag" content="android"> <meta property="og:article:tag" content="EventBus"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    
    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-88090114-1', 'auto');ga('send', 'pageview');
    </script>
    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
        
            <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-88090114-1', 'auto'); ga('send', 'pageview');
</script>
        
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Event Bus一个安卓的优化方式
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>yunfengsa</strong>
        <span>12月 29, 2015</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/EventBus/">EventBus</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/android/">android</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Event Bus一个安卓的优化方式&url=http://yunfengsa.github.io//2015/12/29/eventbus/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Event Bus一个安卓的优化方式&url=http://yunfengsa.github.io//2015/12/29/eventbus/index.html&via=yunfengsa" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yunfengsa.github.io//2015/12/29/eventbus/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yunfengsa.github.io//2015/12/29/eventbus/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>##概述<br>EventBus是一个针对android优化的发布/订阅事件总线.主要目的是替代Itent.handler,broadcast在Fragment activity Service之间进行<em>线程消息传递</em>.<br>优点:开销小,代码优雅,解耦</p>
<p><a href="https://github.com/greenrobot/EventBus" target="_blank" rel="external">源码库点此</a></p>
<p>###基本工作方式<br><img src="http://7xnvyl.com1.z0.glb.clouddn.com/2015-12-19eventbus.png" alt="eb1"></p>
<a id="more"></a>
<p>##实战体验<br>当点击btn_try按钮的时候,跳转到第二个activity,再点击第二个acitivity上面的First Event按钮的时候向第一个Activity发送消息,当第一个activity接收到消息后,显示Toast,并把textview中内容更新.</p>
<p>如下图</p>
<p><img src="http://img.blog.csdn.net/20141102142444304" alt="eb2"></p>
<ul>
<li>基本框架略过(这个很简单)</li>
<li>重点是EventBus的基本使用</li>
</ul>
<p>1.新建一个类(FirstEvent)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstEvent</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> String mMsg;  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FirstEvent</span><span class="params">(String msg)</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO Auto-generated constructor stub  </span></div><div class="line">        mMsg = msg;  </div><div class="line">    &#125;  </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">return</span> mMsg;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.很显然我们需要在第一个activity中订阅注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> com.harvic.other.FirstEvent;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> de.greenrobot.event.EventBus;  </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.content.Intent;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.util.Log;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.widget.Button;  </div><div class="line"><span class="keyword">import</span> android.widget.TextView;  </div><div class="line"><span class="keyword">import</span> android.widget.Toast;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">  </div><div class="line">    Button btn;  </div><div class="line">    TextView tv;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_main);  </div><div class="line">                <span class="comment">//注册EventBus  </span></div><div class="line">        EventBus.getDefault().register(<span class="keyword">this</span>);  </div><div class="line">  </div><div class="line">        btn = (Button) findViewById(R.id.btn_try);  </div><div class="line">        tv = (TextView)findViewById(R.id.tv);  </div><div class="line">  </div><div class="line">        btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(getApplicationContext(),  </div><div class="line">                        SecondActivity.class);  </div><div class="line">                startActivity(intent);  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onDestroy();  </div><div class="line">        EventBus.getDefault().unregister(<span class="keyword">this</span>);<span class="comment">//反注册EventBus  </span></div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><em>关于eventbus的获取方式,既可以new 也可以用默认(一般推荐用后者)</em></p>
<p>3.消息发送(显然是第二个activity进行)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> com.harvic.other.FirstEvent;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> de.greenrobot.event.EventBus;  </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.widget.Button;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">    <span class="keyword">private</span> Button btn_FirstEvent;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_second);  </div><div class="line">        btn_FirstEvent = (Button) findViewById(R.id.btn_first_event);  </div><div class="line">  </div><div class="line">        btn_FirstEvent.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                EventBus.getDefault().post(  </div><div class="line">                        <span class="keyword">new</span> FirstEvent(<span class="string">"FirstEvent btn clicked"</span>));  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4.消息接收</p>
<p>接下来我们需要重写接收函数(在第一个acitivty中),我们暂时先重写onEventMainThread接收消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(FirstEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">    String msg = <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg();  </div><div class="line">    Log.d(<span class="string">"harvic"</span>, msg);  </div><div class="line">    tv.setText(msg);  </div><div class="line">    Toast.makeText(<span class="keyword">this</span>, msg, Toast.LENGTH_LONG).show();  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>基本使用就是这样,很简单 很优雅.</p>
<p>##消息接收的四种方式</p>
<p>我们在例子中用的是其中一个接收函数,其实EventBus共有四种不同的接收函数。</p>
<ul>
<li>onEvent</li>
<li>onEventMainThread</li>
<li>onEventBackground</li>
<li>onEventAsync</li>
</ul>
<p><font color="red">onEvent: </font>这个方法说明发送者和接收者需要在同一个线程中,即post和onEvent需要在同一个线程中.这就会有一个问题了，如果接收onEvent中有延时操作，很明显会出现分发延迟的现象，所以不要在onEvent执行耗时操作。</p>
<p><font color="red">onEventMainThread: </font>这个就很好理解了吧,无论实践是从哪个线程中发布出来的,onEventMainThread都会在UI线程执行,所以当然也不能在其中执行耗时操作啦，出现ANR后果自负哦。</p>
<p><font color="red">onEventBackground: </font>故名思议，不管时间是从主线程post还是从子线程post，onEventBackground都会在子线程执行，如果是子线程post则直接在该子线程中接收执行。</p>
<p><font color="red">onEventAsync: </font>使用这个函数订阅的时候，无论是在哪种线程中post，都会新创建一个子线程进行执行操作。</p>
<p>###那么问题来了，你怎么知道用哪个函数接收呢？</p>
<p>其实很简单我们在onEvent××（）中，会传进去我们相应的Event比如，我们在例子中的onEventMainThread（）中，传进去的就是FirstEvent event。</p>
<p><strong>需要注意的是，如果同一个事件被多个函数接收，则每个接收者都会执行！</strong></p>
<p>##使用没问题了，是不是还是要看看源码呢！</p>
<p>先来register</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Object subscriber, String methodName, <span class="keyword">boolean</span> sticky, <span class="keyword">int</span> priority)</span> </span>&#123;  </div><div class="line">        List&lt;SubscriberMethod&gt; subscriberMethods = subscriberMethodFinder.findSubscriberMethods(subscriber.getClass(),  </div><div class="line">                methodName);  </div><div class="line">        <span class="keyword">for</span> (SubscriberMethod subscriberMethod : subscriberMethods) &#123;  </div><div class="line">            subscribe(subscriber, subscriberMethod, sticky, priority);  </div><div class="line">        &#125;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>subscriber:就是注册的订阅者</p>
<p>methodName：订阅函数名，默认就是“onEvent”</p>
<p>sticky:表示是否是粘性的，一般默认为false，除非你调用registerSticky方法</p>
<p>priority：事件的优先级，默认就行</p>
<p>接着函数找到所有的订阅方法，然后订阅，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function">List&lt;SubscriberMethod&gt; <span class="title">findSubscriberMethods</span><span class="params">(Class&lt;?&gt; subscriberClass, String eventMethodName)</span> </span>&#123;  </div><div class="line">        <span class="comment">//通过订阅者类名+"."+"onEvent"创建一个key  </span></div><div class="line">        String key = subscriberClass.getName() + <span class="string">'.'</span> + eventMethodName;  </div><div class="line">        List&lt;SubscriberMethod&gt; subscriberMethods;  </div><div class="line">        <span class="keyword">synchronized</span> (methodCache) &#123;  </div><div class="line">            <span class="comment">//判断是否有缓存，有缓存直接返回缓存  </span></div><div class="line">            subscriberMethods = methodCache.get(key);  </div><div class="line">        &#125;  </div><div class="line">        <span class="comment">//第一次进来subscriberMethods肯定是Null  </span></div><div class="line">        <span class="keyword">if</span> (subscriberMethods != <span class="keyword">null</span>) &#123;  </div><div class="line">            <span class="keyword">return</span> subscriberMethods;  </div><div class="line">        &#125;  </div><div class="line">        subscriberMethods = <span class="keyword">new</span> ArrayList&lt;SubscriberMethod&gt;();  </div><div class="line">        Class&lt;?&gt; clazz = subscriberClass;  </div><div class="line">        HashSet&lt;String&gt; eventTypesFound = <span class="keyword">new</span> HashSet&lt;String&gt;();  </div><div class="line">        StringBuilder methodKeyBuilder = <span class="keyword">new</span> StringBuilder();  </div><div class="line">        <span class="keyword">while</span> (clazz != <span class="keyword">null</span>) &#123;  </div><div class="line">            String name = clazz.getName();  </div><div class="line">            <span class="comment">//过滤掉系统类  </span></div><div class="line">            <span class="keyword">if</span> (name.startsWith(<span class="string">"java."</span>) || name.startsWith(<span class="string">"javax."</span>) || name.startsWith(<span class="string">"android."</span>)) &#123;  </div><div class="line">                <span class="comment">// Skip system classes, this just degrades performance  </span></div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            <span class="comment">// Starting with EventBus 2.2 we enforced methods to be public (might change with annotations again)  </span></div><div class="line">            <span class="comment">//通过反射，获取到订阅者的所有方法  </span></div><div class="line">            Method[] methods = clazz.getMethods();  </div><div class="line">            <span class="keyword">for</span> (Method method : methods) &#123;  </div><div class="line">                String methodName = method.getName();  </div><div class="line">                <span class="comment">//只找以onEvent开头的方法  </span></div><div class="line">                <span class="keyword">if</span> (methodName.startsWith(eventMethodName)) &#123;  </div><div class="line">                    <span class="keyword">int</span> modifiers = method.getModifiers();  </div><div class="line">                    <span class="comment">//判断订阅者是否是public的,并且是否有修饰符，看来订阅者只能是public的，并且不能被final，static等修饰  </span></div><div class="line">                    <span class="keyword">if</span> ((modifiers &amp; Modifier.PUBLIC) != <span class="number">0</span> &amp;&amp; (modifiers &amp; MODIFIERS_IGNORE) == <span class="number">0</span>) &#123;  </div><div class="line">                        <span class="comment">//获得订阅函数的参数  </span></div><div class="line">                        Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();  </div><div class="line">                        <span class="comment">//看了参数的个数只能是1个  </span></div><div class="line">                        <span class="keyword">if</span> (parameterTypes.length == <span class="number">1</span>) &#123;  </div><div class="line">                            <span class="comment">//获取onEvent后面的部分  </span></div><div class="line">                            String modifierString = methodName.substring(eventMethodName.length());  </div><div class="line">                            ThreadMode threadMode;  </div><div class="line">                            <span class="keyword">if</span> (modifierString.length() == <span class="number">0</span>) &#123;  </div><div class="line">                                <span class="comment">//订阅函数为onEvnet  </span></div><div class="line">                                <span class="comment">//记录线程模型为PostThread,意义就是发布事件和接收事件在同一个线程执行，详细可以参考我对于四个订阅函数不同点分析  </span></div><div class="line">                                threadMode = ThreadMode.PostThread;  </div><div class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (modifierString.equals(<span class="string">"MainThread"</span>)) &#123;  </div><div class="line">                                <span class="comment">//对应onEventMainThread  </span></div><div class="line">                                threadMode = ThreadMode.MainThread;  </div><div class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (modifierString.equals(<span class="string">"BackgroundThread"</span>)) &#123;  </div><div class="line">                                <span class="comment">//对应onEventBackgrondThread  </span></div><div class="line">                                threadMode = ThreadMode.BackgroundThread;  </div><div class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (modifierString.equals(<span class="string">"Async"</span>)) &#123;  </div><div class="line">                                <span class="comment">//对应onEventAsync  </span></div><div class="line">                                threadMode = ThreadMode.Async;  </div><div class="line">                            &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                                <span class="keyword">if</span> (skipMethodVerificationForClasses.containsKey(clazz)) &#123;  </div><div class="line">                                    <span class="keyword">continue</span>;  </div><div class="line">                                &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                                    <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Illegal onEvent method, check for typos: "</span> + method);  </div><div class="line">                                &#125;  </div><div class="line">                            &#125;  </div><div class="line">                            <span class="comment">//获取参数类型，其实就是接收事件的类型  </span></div><div class="line">                            Class&lt;?&gt; eventType = parameterTypes[<span class="number">0</span>];  </div><div class="line">                            methodKeyBuilder.setLength(<span class="number">0</span>);  </div><div class="line">                            methodKeyBuilder.append(methodName);  </div><div class="line">                            methodKeyBuilder.append(<span class="string">'&gt;'</span>).append(eventType.getName());  </div><div class="line">                            String methodKey = methodKeyBuilder.toString();  </div><div class="line">                            <span class="keyword">if</span> (eventTypesFound.add(methodKey)) &#123;  </div><div class="line">                                <span class="comment">// Only add if not already found in a sub class  </span></div><div class="line">                                <span class="comment">//封装一个订阅方法对象，这个对象包含Method对象，threadMode对象，eventType对象  </span></div><div class="line">                                subscriberMethods.add(<span class="keyword">new</span> SubscriberMethod(method, threadMode, eventType));  </div><div class="line">                            &#125;  </div><div class="line">                        &#125;  </div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!skipMethodVerificationForClasses.containsKey(clazz)) &#123;  </div><div class="line">                        Log.d(EventBus.TAG, <span class="string">"Skipping method (not public, static or abstract): "</span> + clazz + <span class="string">"."</span>  </div><div class="line">                                + methodName);  </div><div class="line">                    &#125;  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">            <span class="comment">//看了还会遍历父类的订阅函数  </span></div><div class="line">            clazz = clazz.getSuperclass();  </div><div class="line">        &#125;  </div><div class="line">        <span class="comment">//最后加入缓存，第二次使用直接从缓存拿  </span></div><div class="line">        <span class="keyword">if</span> (subscriberMethods.isEmpty()) &#123;  </div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Subscriber "</span> + subscriberClass + <span class="string">" has no public methods called "</span>  </div><div class="line">                    + eventMethodName);  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            <span class="keyword">synchronized</span> (methodCache) &#123;  </div><div class="line">                methodCache.put(key, subscriberMethods);  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">return</span> subscriberMethods;  </div><div class="line">        &#125;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>上述代码注意看注释</p>
<p>接着就会进入subscribe方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Object subscriber, SubscriberMethod subscriberMethod, <span class="keyword">boolean</span> sticky, <span class="keyword">int</span> priority)</span> </span>&#123;  </div><div class="line">        subscribed = <span class="keyword">true</span>;  </div><div class="line">        <span class="comment">//从订阅方法中拿到订阅事件的类型  </span></div><div class="line">        Class&lt;?&gt; eventType = subscriberMethod.eventType;  </div><div class="line">        <span class="comment">//通过订阅事件类型，找到所有的订阅（Subscription）,订阅中包含了订阅者，订阅方法  </span></div><div class="line">        CopyOnWriteArrayList&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType);  </div><div class="line">        <span class="comment">//创建一个新的订阅  </span></div><div class="line">        Subscription newSubscription = <span class="keyword">new</span> Subscription(subscriber, subscriberMethod, priority);  </div><div class="line">        <span class="comment">//将新建的订阅加入到这个事件类型对应的所有订阅列表  </span></div><div class="line">        <span class="keyword">if</span> (subscriptions == <span class="keyword">null</span>) &#123;  </div><div class="line">            <span class="comment">//如果该事件目前没有订阅列表，那么创建并加入该订阅  </span></div><div class="line">            subscriptions = <span class="keyword">new</span> CopyOnWriteArrayList&lt;Subscription&gt;();  </div><div class="line">            subscriptionsByEventType.put(eventType, subscriptions);  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            <span class="comment">//如果有订阅列表，检查是否已经加入过  </span></div><div class="line">            <span class="keyword">for</span> (Subscription subscription : subscriptions) &#123;  </div><div class="line">                <span class="keyword">if</span> (subscription.equals(newSubscription)) &#123;  </div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Subscriber "</span> + subscriber.getClass() + <span class="string">" already registered to event "</span>  </div><div class="line">                            + eventType);  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        <span class="comment">//根据优先级插入订阅  </span></div><div class="line">        <span class="keyword">int</span> size = subscriptions.size();  </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= size; i++) &#123;  </div><div class="line">            <span class="keyword">if</span> (i == size || newSubscription.priority &gt; subscriptions.get(i).priority) &#123;  </div><div class="line">                subscriptions.add(i, newSubscription);  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        <span class="comment">//将这个订阅事件加入到订阅者的订阅事件列表中  </span></div><div class="line">        List&lt;Class&lt;?&gt;&gt; subscribedEvents = typesBySubscriber.get(subscriber);  </div><div class="line">        <span class="keyword">if</span> (subscribedEvents == <span class="keyword">null</span>) &#123;  </div><div class="line">            subscribedEvents = <span class="keyword">new</span> ArrayList&lt;Class&lt;?&gt;&gt;();  </div><div class="line">            typesBySubscriber.put(subscriber, subscribedEvents);  </div><div class="line">        &#125;  </div><div class="line">        subscribedEvents.add(eventType);  </div><div class="line">        <span class="comment">//这个是对粘性事件的，暂时不讨论  </span></div><div class="line">        <span class="keyword">if</span> (sticky) &#123;  </div><div class="line">            Object stickyEvent;  </div><div class="line">            <span class="keyword">synchronized</span> (stickyEvents) &#123;  </div><div class="line">                stickyEvent = stickyEvents.get(eventType);  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">if</span> (stickyEvent != <span class="keyword">null</span>) &#123;  </div><div class="line">                postToSubscription(newSubscription, stickyEvent, Looper.getMainLooper() == Looper.myLooper());  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>register的基本流程：</p>
<ul>
<li>找到被注册者中的所有订阅方法。</li>
<li>一次遍历订阅方法，找到EventBus中的eventType对应的订阅列表，然后根据当前订阅者和订阅方法创建一个新的订阅到订阅列表。</li>
<li>找到Eventbus中的subscriber订阅的事件列表，将eventType加入到事件列表。</li>
</ul>
<p>所以对于任何一个订阅者，我们可以到找到它的订阅时间类型的列表，然后通过订阅事件类型，可以找到在订阅者中的订阅函数。</p>
<p>最后分析下post</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(Object event)</span> </span>&#123;  </div><div class="line">        <span class="comment">//这个EventBus中只有一个，差不多是个单例吧，具体不用细究  </span></div><div class="line">        PostingThreadState postingState = currentPostingThreadState.get();  </div><div class="line">        List&lt;Object&gt; eventQueue = postingState.eventQueue;  </div><div class="line">        <span class="comment">//将事件放入队列  </span></div><div class="line">        eventQueue.add(event);  </div><div class="line">  </div><div class="line">        <span class="keyword">if</span> (postingState.isPosting) &#123;  </div><div class="line">            <span class="keyword">return</span>;  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            postingState.isMainThread = Looper.getMainLooper() == Looper.myLooper();  </div><div class="line">            postingState.isPosting = <span class="keyword">true</span>;  </div><div class="line">            <span class="keyword">if</span> (postingState.canceled) &#123;  </div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Internal error. Abort state was not reset"</span>);  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">try</span> &#123;  </div><div class="line">                <span class="keyword">while</span> (!eventQueue.isEmpty()) &#123;  </div><div class="line">                    <span class="comment">//分发事件  </span></div><div class="line">                    postSingleEvent(eventQueue.remove(<span class="number">0</span>), postingState);  </div><div class="line">                &#125;  </div><div class="line">            &#125; <span class="keyword">finally</span> &#123;  </div><div class="line">                postingState.isPosting = <span class="keyword">false</span>;  </div><div class="line">                postingState.isMainThread = <span class="keyword">false</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postSingleEvent</span><span class="params">(Object event, PostingThreadState postingState)</span> <span class="keyword">throws</span> Error </span>&#123;  </div><div class="line">       Class&lt;? extends Object&gt; eventClass = event.getClass();  </div><div class="line">    <span class="comment">//找到eventClass对应的事件，包含父类对应的事件和接口对应的事件  </span></div><div class="line">       List&lt;Class&lt;?&gt;&gt; eventTypes = findEventTypes(eventClass);  </div><div class="line">       <span class="keyword">boolean</span> subscriptionFound = <span class="keyword">false</span>;  </div><div class="line">       <span class="keyword">int</span> countTypes = eventTypes.size();  </div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">0</span>; h &lt; countTypes; h++) &#123;  </div><div class="line">           Class&lt;?&gt; clazz = eventTypes.get(h);  </div><div class="line">           CopyOnWriteArrayList&lt;Subscription&gt; subscriptions;  </div><div class="line">           <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;  </div><div class="line">            <span class="comment">//找到订阅事件对应的订阅，这个是通过register加入的（还记得吗....）  </span></div><div class="line">               subscriptions = subscriptionsByEventType.get(clazz);  </div><div class="line">           &#125;  </div><div class="line">           <span class="keyword">if</span> (subscriptions != <span class="keyword">null</span> &amp;&amp; !subscriptions.isEmpty()) &#123;  </div><div class="line">               <span class="keyword">for</span> (Subscription subscription : subscriptions) &#123;  </div><div class="line">                   postingState.event = event;  </div><div class="line">                   postingState.subscription = subscription;  </div><div class="line">                   <span class="keyword">boolean</span> aborted = <span class="keyword">false</span>;  </div><div class="line">                   <span class="keyword">try</span> &#123;  </div><div class="line">                    <span class="comment">//对每个订阅调用该方法  </span></div><div class="line">                       postToSubscription(subscription, event, postingState.isMainThread);  </div><div class="line">                       aborted = postingState.canceled;  </div><div class="line">                   &#125; <span class="keyword">finally</span> &#123;  </div><div class="line">                       postingState.event = <span class="keyword">null</span>;  </div><div class="line">                       postingState.subscription = <span class="keyword">null</span>;  </div><div class="line">                       postingState.canceled = <span class="keyword">false</span>;  </div><div class="line">                   &#125;  </div><div class="line">                   <span class="keyword">if</span> (aborted) &#123;  </div><div class="line">                       <span class="keyword">break</span>;  </div><div class="line">                   &#125;  </div><div class="line">               &#125;  </div><div class="line">               subscriptionFound = <span class="keyword">true</span>;  </div><div class="line">           &#125;  </div><div class="line">       &#125;  </div><div class="line">    <span class="comment">//如果没有订阅发现，那么会Post一个NoSubscriberEvent事件  </span></div><div class="line">       <span class="keyword">if</span> (!subscriptionFound) &#123;  </div><div class="line">           Log.d(TAG, <span class="string">"No subscribers registered for event "</span> + eventClass);  </div><div class="line">           <span class="keyword">if</span> (eventClass != NoSubscriberEvent.class &amp;&amp; eventClass != SubscriberExceptionEvent.class) &#123;  </div><div class="line">               post(<span class="keyword">new</span> NoSubscriberEvent(<span class="keyword">this</span>, event));  </div><div class="line">           &#125;  </div><div class="line">       &#125;  </div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postToSubscription</span><span class="params">(Subscription subscription, Object event, <span class="keyword">boolean</span> isMainThread)</span> </span>&#123;  </div><div class="line">        <span class="comment">//第一个参数就是传入的订阅，第二个参数就是对于的分发事件，第三个参数非常关键：是否在主线程  </span></div><div class="line">        <span class="keyword">switch</span> (subscription.subscriberMethod.threadMode) &#123;  </div><div class="line">        <span class="comment">//这个threadMode是怎么传入的，仔细想想？是不是根据onEvent,onEventMainThread,onEventBackground,onEventAsync决定的？  </span></div><div class="line">        <span class="keyword">case</span> PostThread:  </div><div class="line">            <span class="comment">//直接在本线程中调用订阅函数  </span></div><div class="line">            invokeSubscriber(subscription, event);  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        <span class="keyword">case</span> MainThread:  </div><div class="line">            <span class="keyword">if</span> (isMainThread) &#123;  </div><div class="line">                <span class="comment">//如果直接在主线程，那么直接在本现场中调用订阅函数  </span></div><div class="line">                invokeSubscriber(subscription, event);  </div><div class="line">            &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                <span class="comment">//如果不在主线程，那么通过handler实现在主线程中执行，具体我就不跟踪了  </span></div><div class="line">                mainThreadPoster.enqueue(subscription, event);  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        <span class="keyword">case</span> BackgroundThread:  </div><div class="line">            <span class="keyword">if</span> (isMainThread) &#123;  </div><div class="line">                <span class="comment">//如果主线程，创建一个runnable丢入线程池中  </span></div><div class="line">                backgroundPoster.enqueue(subscription, event);  </div><div class="line">            &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                <span class="comment">//如果子线程，则直接调用  </span></div><div class="line">                invokeSubscriber(subscription, event);  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        <span class="keyword">case</span> Async:  </div><div class="line">            <span class="comment">//不论什么线程，直接丢入线程池  </span></div><div class="line">            asyncPoster.enqueue(subscription, event);  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        <span class="keyword">default</span>:  </div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Unknown thread mode: "</span> + subscription.subscriberMethod.threadMode);  </div><div class="line">        &#125;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>最后在postToSubscription中能够看到四种订阅处理方法的区别</strong></p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    







                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/01/04/labmbdaanddelegate/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2015/11/12/android-jvm-gc/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="yunfengsa's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        proljl1991@email.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">十二月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">十一月 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">十月 2015<span class="sidebar_archives-count">12</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Chromium/">Chromium<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Database/">Database<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Markdown/">Markdown<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Ruby/">Ruby<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/android/">android<span class="sidebar_archives-count">18</span></a></li><li><a class="sidebar_archives-link" href="/categories/gradle/">gradle<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/ndk/">ndk<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/octopress/">octopress<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/opencv/">opencv<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/rails/">rails<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/ruby/">ruby<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/rx/">rx<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/weex/">weex<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/设计模式/">设计模式<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                标签云
            </a>
        </li>
        
    
        <li>
            <a href="/gallery" title="My Gallery">
                
                    <i class="material-icons sidebar-material-icons">image</i>
                
                My Gallery
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="About me">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About me
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">33</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/yunfengsa" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;云枫飒的笔记BLOG
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>
















<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
